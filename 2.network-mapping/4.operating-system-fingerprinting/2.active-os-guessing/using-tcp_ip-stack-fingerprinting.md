# Network Mapping
## Operating System Fingerprinting
### Active OS Guessing - Using TCP/IP Stack Fingerprinting

#### Description
If nmap can find an open and a closed port, it will send a series of probes and compare the responses received with an internal database of OS fingerprints. That is the ideal scenario (one port open, one port closed), and if the OS is not identified and the assessor knows exactly what OS it is, the fingerprint can be submitted for inclusion in future nmap versions. If nmap can not find an open and a closed port, it will try its best with the information received, providing a guess on the OS of the remote system.

Active OS guessing will provide information on the O.S. brand and version. This information will be useful to tune active tests (e.g. vulnerability scanning).

Companies should do their best to thwart O.S. identification of critical systems. 

#### Tools
* Nmap
* Queso
* Several protocol analyzers and packet generators

#### Examples
Using nmap with -O parameter:
```bash
$ nmap -O 192.168.1.254

Starting nmap 3.81 ( http://www.insecure.org/nmap/ ) at 2005-06-04 19:45 CDT
Interesting ports on gateway (192.168.1.254): 
(The 1662 ports scanned but not shown below are in state: closed) 
PORT   STATE SERVICE 
80/tcp open  http 
MAC Address: 00:06:25:EC:CC:D9 (The Linksys Group) 
Device type: WAP|broadband router 
Running: Linksys embedded 
OS details: Linksys BEFW11S4 WAP or BEFSR41 router 
```

Scanning a host behind a firewall (port 80 is open, and port 55555 is known to be closed, but currently firewalled):
```bash
$ nmap -sT -O -p80,55555 192.168.1.10

Starting  Nmap  4.01  (  http://www.insecure.org/nmap  )  at  2006-02-25  12:34  GMT Standard Time 

Warning:  OS detection will be MUCH less reliable because we did not find at least 1 open and 1 closed TCP port
Insufficient  responses  for  TCP  sequencing  (0),  OS  detection  may  be  less  accurate
Insufficient  responses  for  TCP  sequencing  (0),  OS  detection  may  be  less  accurate 
Insufficient  responses  for  TCP  sequencing  (0),  OS  detection  may  be  less  accurate 
Interesting ports on 192.168.1.10: 
PORT      STATE    SERVICE 
80/tcp    open     http 
55555/tcp filtered unknown 

Aggressive  OS  guesses:  Netscreen  5XP  firewall+vpn  (OS  3.0.1r2)  (92%),  Netscreen 5XP firewall+vpn (os 4.0.3r2.0) (91%), ZyXel ZyWALL 50 (ZyNOS 3.52) (90%), CastleNet AR502/GlobespanVirata GS8100 (same thing) DSL router (90%), Easytel TeleWell  EA-701B  ADSL  Modem/Router  (90%),  Intergraph  jetSpeed  520  ADSL  Router  (90%), Netopia DSL Router (90%), Netopia DSL router (90%), Netopia R9100 DSL Router (90%), NetScreen-100 (90%) 
No exact OS matches for host (test conditions non-ideal). 

Nmap finished: 1 IP address (1 host up) scanned in 22.463 seconds 
```
